<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="xxl-job"><meta name="description" content="本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="baidu-site-verification" content="code-Fqqme2bKQz"><title>分布式任务调度 xxl-job | Crys&#39;s Blog</title><link rel="icon" type="image/png" href="/crystal-blog/favicon.png"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/awesome/css/all.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/css/matery.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/css/my.css"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/artitalk/artitalk.min.css"><script src="/crystal-blog/libs/jquery/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/crystal-blog/atom.xml" title="Crys's Blog" type="application/atom+xml"><link rel="stylesheet" href="/crystal-blog/css/prism-tomorrow.css" type="text/css"></head><style>body{background-image:url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);background-repeat:no-repeat;background-size:cover;background-attachment:fixed}</style><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo" style="margin-left:-50px"><a href="/crystal-blog/" class="waves-effect waves-light"><img src="https://cdn.jsdelivr.net/gh/guixinchn/image/blog/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">Crys&#39;s Blog</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu" style="margin-left:100px"><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-list" style="zoom:.6"></i> <span>清单</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/crystal-blog/musics"><i class="fas fa-music" style="margin-top:-20px;zoom:.6"></i> <span>音乐</span></a></li><li><a href="/crystal-blog/videos"><i class="fas fa-video" style="margin-top:-20px;zoom:.6"></i> <span>视频</span></a></li><li><a href="/crystal-blog/movies"><i class="fas fa-film" style="margin-top:-20px;zoom:.6"></i> <span>影集</span></a></li><li><a href="/crystal-blog/wallpaper"><i class="fas fa-image" style="margin-top:-20px;zoom:.6"></i> <span>壁纸</span></a></li><li><a href="/crystal-blog/galleries"><i class="fas fa-camera" style="margin-top:-20px;zoom:.6"></i> <span>相册</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-rocket" style="zoom:.6"></i> <span>关于</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/crystal-blog/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:.6"></i> <span>关于我</span></a></li><li><a href="/crystal-blog/aboutgirl"><i class="fa fa-user-secret" style="margin-top:-20px;zoom:.6"></i> <span>关于她</span></a></li><li><a target="_blank" rel="noopener" href="http://www.itsoku.com/"><i class="fab fa-github-alt" style="margin-top:-20px;zoom:.6"></i> <span>充电社</span></a></li><li><a href="/crystal-blog/artitalk"><i class="fas fa-pen-alt" style="margin-top:-20px;zoom:.6"></i> <span>artitalk</span></a></li><li><a href="/crystal-blog/bb"><i class="fas fa-comment" style="margin-top:-20px;zoom:.6"></i> <span>bbtalk</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/navigate" class="waves-effect waves-light"><i class="fas fa-location-arrow" style="zoom:.6"></i> <span>快捷导航</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/crystal-blog/atom.xml" class="waves-effect waves-light"><i class="fas fa-rss" style="zoom:.6"></i> <span>RSS</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/guixinchn/image/blog/logo.png" class="logo-img circle responsive-img"><div class="logo-name">Crys&#39;s Blog</div><div class="logo-desc">本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/crystal-blog/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/crystal-blog/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/crystal-blog/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/crystal-blog/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-list"></i> 清单 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/crystal-blog/musics" style="margin-left:50px"><i class="fa fas fa-music" style="position:absolute;left:28px"></i> <span>音乐</span></a></li><li><a href="/crystal-blog/videos" style="margin-left:50px"><i class="fa fas fa-video" style="position:absolute;left:28px"></i> <span>视频</span></a></li><li><a href="/crystal-blog/movies" style="margin-left:50px"><i class="fa fas fa-film" style="position:absolute;left:28px"></i> <span>影集</span></a></li><li><a href="/crystal-blog/wallpaper" style="margin-left:50px"><i class="fa fas fa-image" style="position:absolute;left:28px"></i> <span>壁纸</span></a></li><li><a href="/crystal-blog/galleries" style="margin-left:50px"><i class="fa fas fa-camera" style="position:absolute;left:28px"></i> <span>相册</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-rocket"></i> 关于 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/crystal-blog/about" style="margin-left:50px"><i class="fa fas fa-user-circle" style="position:absolute;left:28px"></i> <span>关于我</span></a></li><li><a href="/crystal-blog/aboutgirl" style="margin-left:50px"><i class="fa fa fa-user-secret" style="position:absolute;left:28px"></i> <span>关于她</span></a></li><li><a target="_blank" rel="noopener" href="http://www.itsoku.com/" style="margin-left:50px"><i class="fa fab fa-github-alt" style="position:absolute;left:28px"></i> <span>充电社</span></a></li><li><a href="/crystal-blog/artitalk" style="margin-left:50px"><i class="fa fas fa-pen-alt" style="position:absolute;left:28px"></i> <span>artitalk</span></a></li><li><a href="/crystal-blog/bb" style="margin-left:50px"><i class="fa fas fa-comment" style="position:absolute;left:28px"></i> <span>bbtalk</span></a></li></ul></li><li class="m-nav-item"><a href="/crystal-blog/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/crystal-blog/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li class="m-nav-item"><a href="/crystal-blog/navigate" class="waves-effect waves-light"><i class="fa-fw fas fa-location-arrow"></i> 快捷导航</a></li><li class="m-nav-item"><a href="/crystal-blog/atom.xml" class="waves-effect waves-light"><i class="fa-fw fas fa-rss"></i> RSS</a></li><li><div class="divider"></div></li><li><a href="https://gitee.com/wang-qz/hexo-blog-crystal" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i>Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://gitee.com/wang-qz/hexo-blog-crystal" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><script src="/crystal-blog/libs/cryptojs/crypto-js.min.js"></script><script></script><div class="bg-cover pd-header post-cover" style="background-image:url(https://cn.bing.com/th?id=OHR.Koenigsbourg_ZH-CN7675452866_1920x1080.jpg&rf=LaDigue_1920x1080.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">分布式任务调度 xxl-job</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/crystal-blog/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{padding:35px 0 15px 17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{padding-bottom:30px;overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/crystal-blog/tags/xxl-job/"><span class="chip bg-color">xxl-job</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/crystal-blog/categories/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/" class="post-category">任务调度</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2021-12-12</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2021-12-12</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 3.8k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 15 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h2 id="1-集中式任务调度"><a href="#1-集中式任务调度" class="headerlink" title="1. 集中式任务调度"></a>1. 集中式任务调度</h2><p>集中式任务与分布式任务调度恰好相反的概念，集中式任务就是单机任务，一个项目，一台服务器，也就是我们常说的单体应用。对于集中式任务，也就是我们Java开发中常见的定时任务。</p><h3 id="1-1-定时任务"><a href="#1-1-定时任务" class="headerlink" title="1.1 定时任务"></a>1.1 定时任务</h3><p>定时任务是指在指定时间去执行任务（业务代码）；</p><p><strong>定时任务基本概念图</strong><br><img src="https://img-blog.csdnimg.cn/1040400a7ddc4e5690815cb98fe33c2b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_15,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br><strong>定时任务应用场景</strong><br><img src="https://img-blog.csdnimg.cn/a42e47435a43469b818a01b3785210e0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h3 id="1-2-Java实现定时任务方式"><a href="#1-2-Java实现定时任务方式" class="headerlink" title="1.2 Java实现定时任务方式"></a>1.2 Java实现定时任务方式</h3><p>(1) while(true) + Thread.sleep</p><p>(2) java.util.Timer + java.util.TimerTask<br>Timer是一种定时器工具，用来在一个后台线程计划执行指定任务，它可以计划执行一个任务一次或反复多次。</p><p>(3) ScheduledExecutorService<br>ScheduledExecutorService 是从jdk1.5开始为并发工具类被引入，是最理想的定时任务实现方式。</p><p>(4) Quartz<br>Quartz是一个开源的定时任务调度框架，由Java编写而成，用于Java生态下的定时任务调度，是一个灵活方便、使用简单的定时任务调度框架，可以和Spring整合使用。</p><p>(5) Spring Task<br>Spring框架提供的轻量级的定时任务调用工具，使用方便；</p><p>(6) SpringBoot注解@EnableScheduling + @Scheduled ; 底层依赖采用Spring Task；</p><h3 id="1-3-集中式任务调度的缺陷"><a href="#1-3-集中式任务调度的缺陷" class="headerlink" title="1.3 集中式任务调度的缺陷"></a>1.3 集中式任务调度的缺陷</h3><ul><li>不支持分片任务. 处理有序数据时, 多机器分片执行任务处理不同数据.</li><li>不支持生命周期统一管理. 不重启服务情况下关闭, 启动任务.</li><li>不支持集群, 存在任务重复执行的问题.</li><li>不支持失败重试. 出现异常后任务终结, 不能根据执行状态控制任务重新执行.</li><li>不支持动态调整. 不重启服务的情况下修改任务参数.</li><li>无报警机制. 任务失败之后没有报警机制.</li><li>任务数据难以统计. 任务数据量大时, 对于任务执行情况无法高效的统计执行情况.</li></ul><h2 id="2-分布式任务调度"><a href="#2-分布式任务调度" class="headerlink" title="2. 分布式任务调度"></a>2. 分布式任务调度</h2><h3 id="2-1-解决方案"><a href="#2-1-解决方案" class="headerlink" title="2.1 解决方案"></a>2.1 解决方案</h3><p>由于集中式的定时任务调度需要解决一系列问题，所以在演进的过程中产生一些解决办法</p><ul><li>数据库唯一约束；</li><li>使用配置文件、redis、mysql作为调度的开关；</li><li>使用分布式锁实现调度的控制；</li><li>使用分布式任务调度平台 TBSchedule、Elastic-Job、Saturn、XXL-JOB等；</li><li>自研框架。</li></ul><h3 id="2-2-分布式任务调度的好处"><a href="#2-2-分布式任务调度的好处" class="headerlink" title="2.2 分布式任务调度的好处"></a>2.2 分布式任务调度的好处</h3><p>解决集中式任务调度的先天缺陷.</p><ul><li>高可用. 集群架构下, 有节点出现异常, 不影响任务的执行.</li><li>动态配置. 对任务执行周期, 及其他跟任务相关的属性不停机修改.</li><li>生命周期管理. 可以不停机的情况下对任务单次执行启动任务, 停止任务进行管理.</li><li>失败机制. 在任务执行过程中出现执行失败, 可以支持报警, 任务重试并快速查阅执行日志.</li><li>数据统计. 定时任务数比较多的情况, 有多少任务, 哪些任务执行失败过, 哪些任务执行成功.</li><li>分片执行. 对于批量处理的数据, 让对台机器执行该任务, 对处理数据进行分片处理.</li></ul><h3 id="2-3-开源框架"><a href="#2-3-开源框架" class="headerlink" title="2.3 开源框架"></a>2.3 开源框架</h3><p><strong>TBSchedule</strong><br>淘宝推出的开源分布式任务调用系统，在很多互联网公司应用很广，但现在没用更新维护了；<br>GitHub地址: <a target="_blank" rel="noopener" href="https://github.com/taobao/TBSchedule">https://github.com/taobao/TBSchedule</a></p><p><strong>Elastic-Job</strong><br>当当网推出的分布式任务调度框架，很多公司的产品在使用该分布式任务调度框架；<br>官网 <a target="_blank" rel="noopener" href="http://elasticjob.io/">http://elasticjob.io</a></p><p><strong>Saturn</strong><br>唯品会推出的开源分布式任务调度平台，它是基于Elastic-Job开发的，新增了一些特性，在唯品会内部以及一些互联网公司在使用。<br>GitHub地址： <a target="_blank" rel="noopener" href="https://github.com/vipshop/Saturn">https://github.com/vipshop/Saturn</a></p><p><strong>PowerJob</strong><br>新一代分布式任务调度与计算框架，支持CRON、API、固定频率、固定延迟等调度策略，提供工作流来编排任务解决依赖关系，使用简单，功能强大，文档齐全。<br>官网: <a target="_blank" rel="noopener" href="http://www.powerjob.tech/">http://www.powerjob.tech/</a><br>GitHub开源地址: <a target="_blank" rel="noopener" href="https://github.com/KFCFans/PowerJob">https://github.com/KFCFans/PowerJob</a><br>Gitee开源地址: <a target="_blank" rel="noopener" href="https://gitee.com/KFCFans/PowerJob">https://gitee.com/KFCFans/PowerJob</a></p><p><strong>XXL-JOB</strong><br>美团开源的轻量级分布式任务调度平台，其核心设计目标是轻量级、易扩展、开发迅速、开箱即用，已有多家公司线上产品使用。该项目于2015年11月发布第一个版本1.0，目前最新版本2.xxx<br>官网： <a target="_blank" rel="noopener" href="https://www.xuxueli.com/xxl-job/">https://www.xuxueli.com/xxl-job/</a><br>GitHub地址： <a target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job/">https://github.com/xuxueli/xxl-job/</a><br>Gitee地址: <a target="_blank" rel="noopener" href="https://gitee.com/xuxueli0323/xxl-job">https://gitee.com/xuxueli0323/xxl-job/</a></p><h2 id="3-xxl-job框架"><a href="#3-xxl-job框架" class="headerlink" title="3. xxl-job框架"></a>3. xxl-job框架</h2><p>xxl-job是一个分布式任务调度平台. 学习博客： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/newAndHui/p/13862285.html">https://www.cnblogs.com/newAndHui/p/13862285.html</a></p><h3 id="3-1-架构图"><a href="#3-1-架构图" class="headerlink" title="3.1 架构图"></a>3.1 架构图</h3><p><strong>xxl-job架构图</strong><br><img src="https://img-blog.csdnimg.cn/37c56baafe0a4832b8580bc4d416d0bc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="xxl-job架构图"><br><strong>任务触发架构图</strong><br>任务调度—任务触发—执行器<br><img src="https://img-blog.csdnimg.cn/fbf819f3295c46338038d33e72a3254d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h3 id="3-2-xxl-job安装使用说明"><a href="#3-2-xxl-job安装使用说明" class="headerlink" title="3.2 xxl-job安装使用说明"></a>3.2 xxl-job安装使用说明</h3><h4 id="3-2-1-社区支持及源码下载"><a href="#3-2-1-社区支持及源码下载" class="headerlink" title="3.2.1 社区支持及源码下载"></a>3.2.1 社区支持及源码下载</h4><p>许雪里社区 <a target="_blank" rel="noopener" href="https://www.xuxueli.com/page/projects.html">https://www.xuxueli.com/page/projects.html</a><br>xxl-job的GitHub地址 <a target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job/">https://github.com/xuxueli/xxl-job/</a></p><h4 id="3-2-2-初始化admin数据库"><a href="#3-2-2-初始化admin数据库" class="headerlink" title="3.2.2 初始化admin数据库"></a>3.2.2 初始化admin数据库</h4><p>初始化任务调用中心admin数据库, sql脚本在源码目录<code>xxl-job/doc/db/</code>下, tables_xxl_job.sql文件.<br><img src="https://img-blog.csdnimg.cn/5ef0b9d03c3c4d7ebc08178868727df9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h4 id="3-2-3-修改admin配置文件"><a href="#3-2-3-修改admin配置文件" class="headerlink" title="3.2.3 修改admin配置文件"></a>3.2.3 修改admin配置文件</h4><p>主要修改db配置；<br><img src="https://img-blog.csdnimg.cn/57e1a1a6644d4eaa83547e4c147e40a4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>端口 , 上下文名称也可以自己修改.<br><img src="https://img-blog.csdnimg.cn/cef66ea2dba2423f9cff19b4280916b1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h4 id="3-2-4-访问admin首页"><a href="#3-2-4-访问admin首页" class="headerlink" title="3.2.4 访问admin首页"></a>3.2.4 访问admin首页</h4><p>启动admin应用, 访问admin首页<code>http://127.0.0.1:8081/xxl-job-admin</code>，查看执行器列表、任务列表.<br>用户名 admin<br>密码 123456</p><p><img src="https://img-blog.csdnimg.cn/6956791be5d943b899977f825743fb4e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="admin首页"></p><h4 id="3-2-5-新增执行器"><a href="#3-2-5-新增执行器" class="headerlink" title="3.2.5 新增执行器"></a>3.2.5 新增执行器</h4><p>执行器管理页面新增执行器.<br><img src="https://img-blog.csdnimg.cn/abd874cb93d0449a808c76a0839c7cb0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>新增执行器成功：<br><img src="https://img-blog.csdnimg.cn/b7dd80dc9dce4560b8fa18d6ddf30f7b.png" alt="在这里插入图片描述"></p><h4 id="3-2-6-新增任务"><a href="#3-2-6-新增任务" class="headerlink" title="3.2.6 新增任务"></a>3.2.6 新增任务</h4><p>任务管理页面新增任务.<br><img src="https://img-blog.csdnimg.cn/4259e711fc56424f9ee23fd2f1b95c64.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>新增任务成功：</p><p><img src="https://img-blog.csdnimg.cn/3a95547aad66440fa0ea53663f9c2a7c.png" alt="在这里插入图片描述"></p><h4 id="3-2-7-执行器依赖核心包"><a href="#3-2-7-执行器依赖核心包" class="headerlink" title="3.2.7 执行器依赖核心包"></a>3.2.7 执行器依赖核心包</h4><p>xxl-job-executor-sample执行器应用中，添加依赖，配置属性，编写任务等；<br><img src="https://img-blog.csdnimg.cn/3f5683fc23cd447187be8d49558702ff.png" alt="在这里插入图片描述"><br>1）添加maven依赖</p><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.xuxueli<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>xxl-job-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${project.parent.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre><p>2）配置文件信息<br>db相关配置信息，日志目录配置可以自定义等；</p><pre class="language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true">###任务调度中心地址</span>
<span class="token comment" spellcheck="true">#### xxl-job admin address list, such as "http://address" or "http://address01,http://address02"</span>
xxl.job.admin.addresses=http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8081/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin

<span class="token comment" spellcheck="true">#### xxl-job, access token</span>
xxl.job.accessToken=

<span class="token comment" spellcheck="true">#### xxl-job executor appname</span>
xxl.job.executor.appname=xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>executor<span class="token punctuation">-</span>sample
<span class="token comment" spellcheck="true">#### xxl-job executor registry-address: default use address to registry , otherwise use ip:port if address is null</span>
xxl.job.executor.address=
<span class="token comment" spellcheck="true">#### xxl-job executor server-info</span>
xxl.job.executor.ip=
xxl.job.executor.port=9998
<span class="token comment" spellcheck="true">#### xxl-job executor log-path</span>
xxl.job.executor.logpath=/data/applogs/xxl<span class="token punctuation">-</span>job/jobhandler
<span class="token comment" spellcheck="true">#### xxl-job executor log-retention-days</span>
xxl.job.executor.logretentiondays=30
</code></pre><p>3）配置类XxlJobConfig<br>实例化执行器 XxlJobSpringExecutor</p><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>XxlJobSpringExecutor<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * xxl-job config
 *
 * @author xuxueli 2017-04-28
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxlJobConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>XxlJobConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.admin.addresses}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String adminAddresses<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.accessToken}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String accessToken<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.appname}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String appname<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.address}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.ip}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String ip<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.port}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.logpath}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String logPath<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.logretentiondays}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> logRetentionDays<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> XxlJobSpringExecutor <span class="token function">xxlJobExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">">>>>>>>>>>> xxl-job config init."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        XxlJobSpringExecutor xxlJobSpringExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XxlJobSpringExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAdminAddresses</span><span class="token punctuation">(</span>adminAddresses<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAppname</span><span class="token punctuation">(</span>appname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setLogPath</span><span class="token punctuation">(</span>logPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setLogRetentionDays</span><span class="token punctuation">(</span>logRetentionDays<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> xxlJobSpringExecutor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 针对多网卡、容器内部署等情况，可借助 "spring-cloud-commons" 提供的 "InetUtils" 组件灵活定制注册IP；
     *
     *      1、引入依赖：
     *          &lt;dependency>
     *             &lt;groupId>org.springframework.cloud&lt;/groupId>
     *             &lt;artifactId>spring-cloud-commons&lt;/artifactId>
     *             &lt;version>${version}&lt;/version>
     *         &lt;/dependency>
     *
     *      2、配置文件，或者容器启动变量
     *          spring.cloud.inetutils.preferred-networks: 'xxx.xxx.xxx.'
     *
     *      3、获取IP
     *          String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress();
     */</span>
<span class="token punctuation">}</span>
</code></pre><p>4）创建handler接口<br>老版本是创建handler类， 继承了IJobHandler类，重写了execute方法，并被调度执行execute方法。</p><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlueJobHandler</span> <span class="token keyword">extends</span> <span class="token class-name">IJobHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> glueUpdatetime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> IJobHandler jobHandler<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">GlueJobHandler</span><span class="token punctuation">(</span>IJobHandler jobHandler<span class="token punctuation">,</span> <span class="token keyword">long</span> glueUpdatetime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jobHandler <span class="token operator">=</span> jobHandler<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>glueUpdatetime <span class="token operator">=</span> glueUpdatetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getGlueUpdatetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> glueUpdatetime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        XxlJobHelper<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"----------- glue.version:"</span><span class="token operator">+</span> glueUpdatetime <span class="token operator">+</span><span class="token string">" -----------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobHandler<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>新版本不再是继承IJobHandler，而是编写一个类用注解@Component实例化到容器中，在类中的方法上添加注解<code>@XxlJob("jobName")</code>注解标注这个方法就是要调度执行的任务。</p><pre class="language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * XxlJob开发示例（Bean模式）
 *
 * 开发步骤：
 *      1、任务开发：在Spring Bean实例中，开发Job方法；
 *      2、注解配置：为Job方法添加注解 "@XxlJob(value="自定义jobhandler名称", init = "JobHandler初始化方法", destroy = "JobHandler销毁方法")"，注解value值对应的是调度中心新建任务的JobHandler属性的值。
 *      3、执行日志：需要通过 "XxlJobHelper.log" 打印执行日志；
 *      4、任务结果：默认任务结果为 "成功" 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 "XxlJobHelper.handleFail/handleSuccess" 自主设置任务结果；
 *
 * @author xuxueli 2019-12-11 21:52:51
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleXxlJob</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>SampleXxlJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * 1、简单任务示例（Bean模式）
     */</span>
    <span class="token annotation punctuation">@XxlJob</span><span class="token punctuation">(</span><span class="token string">"demoJobHandler"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demoJobHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        XxlJobHelper<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"XXL-JOB, Hello World."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行了 demoJobHandler --"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            XxlJobHelper<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"beat at:"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// default success</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre><h2 id="4-xxl-job集群部署"><a href="#4-xxl-job集群部署" class="headerlink" title="4. xxl-job集群部署"></a>4. xxl-job集群部署</h2><h3 id="4-1-xxl-job-admin集群部署"><a href="#4-1-xxl-job-admin集群部署" class="headerlink" title="4.1 xxl-job-admin集群部署"></a>4.1 xxl-job-admin集群部署</h3><p>首先集群部署几台 xxl-job-admin，8080 ，8081端口两台调度中心；<br>操作：xxl-job-admin.jar 包准备<br>启动两台任务调度中心：<br>java -jar xxl-job-admin.jar –server.port=8080<br>java -jar xxl-job-admin.jar –server.port=8081<br>访问任务调度平台：<br><code>http://localhost:8080/xxl-job-admin/</code><br><img src="https://img-blog.csdnimg.cn/1b23f08ef70f4617916e5a8aa698bf94.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br><code>http://localhost:8081/xxl-job-admin/</code><br><img src="https://img-blog.csdnimg.cn/ae63e281a68942a4ac6f149a5c7a6389.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h3 id="4-2-xxl-job-executor-example集群部署"><a href="#4-2-xxl-job-executor-example集群部署" class="headerlink" title="4.2 xxl-job-executor-example集群部署"></a>4.2 xxl-job-executor-example集群部署</h3><h4 id="4-2-1-集群部署配置"><a href="#4-2-1-集群部署配置" class="headerlink" title="4.2.1 集群部署配置"></a>4.2.1 集群部署配置</h4><p>如果<code>xxl-job-admin</code>任务调度中心是集群部署，<code>xxl-job-executor-sample</code>执行器应该通过负载均衡地址进行注册，可以将<code>xxl.job.admin.addresses</code>配置成负载均衡地址或域名；然后分别启动多台<code>执行器</code>应用进行注册。注册之前需要将负载均衡的配置准备好，下面介绍：<br>执行器注册地址的配置，执行器注册地址使用 <code>域名-&gt;nginx代理(负载均衡)-&gt;任务调度平台</code></p><pre class="language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true">### 单机</span>
<span class="token comment" spellcheck="true"># xxl.job.admin.addresses=http://127.0.0.1:8081/xxl-job-admin</span>
<span class="token comment" spellcheck="true">### 集群部署，通过负载均衡的域名地址去注册执行器  域名在hosts文件中配置</span>
xxl.job.admin.addresses=http<span class="token punctuation">:</span>//www.jobs.com/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin
</code></pre><p>windows系统hosts文件配置域名，并刷新dns配置；当访问<a target="_blank" rel="noopener" href="http://www.jobs.com时就相当于访问的是127.0.0.1的主机地址.当然我们也可以不用域名解析,直接配置主机地址.hosts文件位置/">www.jobs.com时就相当于访问的是127.0.0.1的主机地址。当然我们也可以不用域名解析，直接配置主机地址。hosts文件位置</a> <code>C:\Windows\System32\drivers\etc</code><br><img src="https://img-blog.csdnimg.cn/428bb18c99ca4826b6cd86ce6b4ce730.png" alt="在这里插入图片描述"><br>刷新dns配置： ipconfig /flushdns<br><img src="https://img-blog.csdnimg.cn/f63e23a87c0947e89a10619e09cd4d5f.png" alt="在这里插入图片描述"><br>Nginx负载均衡拦截配置，当执行器应用向xxl-job-admin注册时，进行负载均衡转发。<br><img src="https://img-blog.csdnimg.cn/6e873886eee04c9c901d288792c18bcd.png" alt="在这里插入图片描述"><br>Nginx负载均衡配置，随机转发到两台任务调度中心：<code>admin-8080, admin-8088</code>；<br>如果访问 <code>http://localhost:80/xxl-job-admin</code> 会随机转发到下面地址：<br><code>http://localhost:8080/xxl-job-admin</code><br><code>http://localhost:8081/xxl-job-admin</code><br>注意，上面的80是nginx监听的端口。<br><img src="https://img-blog.csdnimg.cn/233e0f56a6264564bcad423e459c9504.png" alt="在这里插入图片描述"><br>修改完nginx.conf配置文件后，检查配置文件是否配置正确：</p><pre class="language-bash"><code class="language-bash">nginx -t -c /softwareInstalled/nginx-1.20.1/conf/nginx.conf
</code></pre><p>如果nginx已经启动，重新加载配置，并优雅的重启进程</p><pre class="language-bash"><code class="language-bash">nginx -s reload
</code></pre><p>如果nginx没启动，那么直接启动Nginx</p><pre class="language-bash"><code class="language-bash">start nginx
</code></pre><h4 id="4-2-2-注册执行器"><a href="#4-2-2-注册执行器" class="headerlink" title="4.2.2 注册执行器"></a>4.2.2 注册执行器</h4><p>根据上图原理，注册两台注册器到任务调度中心<br>第一台执行器修改配置并启动：</p><pre class="language-yaml"><code class="language-yaml">server.port=8082
xxl.job.admin.addresses=http<span class="token punctuation">:</span>//www.jobs.com/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin
xxl.job.executor.port=9998
</code></pre><p>第二台执行器修改配置并启动</p><pre class="language-yaml"><code class="language-yaml">server.port=8088
xxl.job.admin.addresses=http<span class="token punctuation">:</span>//www.jobs.com/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin
xxl.job.executor.port=9999
</code></pre><p>查看任务调度中心的“执行器管理”, 两台执行器已经注册成功。<br><code>http://localhost:8080/xxl-job-admin/jobgroup</code><br><img src="https://img-blog.csdnimg.cn/4bd70dc69a0d415eb9bfac895c8bd377.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br><code>http://localhost:8081/xxl-job-admin/jobgroup</code><br><img src="https://img-blog.csdnimg.cn/2ebf849c0f0f4ddc9d9cc1287ab92152.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>从执行器注册流程图可以分析出，<code>8082，8088</code>执行器注册到<code>8080和8081</code>调度中心；任务调度中心触发任务时通过<code>9998、9999</code>端口调度执行器去执行任务。（8082、8088端口是执行器对外的web端口）<br><img src="https://img-blog.csdnimg.cn/93cbb29d88cf4bfabb68312b18b458b2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h4 id="4-2-3-任务调度测试"><a href="#4-2-3-任务调度测试" class="headerlink" title="4.2.3 任务调度测试"></a>4.2.3 任务调度测试</h4><p>手动执行一次任务，查看执行日志。根据权重转发到了注册到<code>9998</code>的执行器上。<br><img src="https://img-blog.csdnimg.cn/5ee5adc493cd4997b5421a3fa9f3067e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>将注册到<code>9998</code>的执行器停掉。再次手动触发一次任务，注册到<code>9999</code>的执行器依然可以成功执行任务。<br><img src="https://img-blog.csdnimg.cn/a10c98d80ea64c009c24d62cfc6609b5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>从下面任务调度图可以分析出，<code>8080，8081</code>调度中心是和执行器的<code>9998，9999</code>端口通信的。路由策略也可以自己调整（随机、轮询、指定执行器服务等）。<br><img src="https://img-blog.csdnimg.cn/6ac42c831b3342cea73dd69aba85c047.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY3J5c3RhbF9oYWNrZXI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h2 id="5-xxl-job设计思想"><a href="#5-xxl-job设计思想" class="headerlink" title="5. xxl-job设计思想"></a>5. xxl-job设计思想</h2><ul><li>将调度行为抽象形成“调度中心”公共平台，而平台自身并不承担业务逻辑，“调度中心”负责发起调度请求。</li><li>将任务抽象成分散的JobHandler，交由“执行器”统一管理，“执行器”负责接收调度请求并执行对应的JobHandler中业务逻辑。因此，“调度”和“任务”两部分可以相互解耦，提高系统整体稳定性和扩展性；</li><li>调度模块（调度中心）：负责管理调度信息，按照调度配置发出调度请求，自身不承担业务代码。调度系统与任务解耦，提高了系统可用性和稳定性，同时调度系统性能不再受限于任务模块；</li><li>支持可视化、简单且动态的管理调度信息，包括任务新建、更新、删除、GLUE开发和任务报警等，所有上述操作都会实时生效，同时支持监控调度结果以及执行日志，支持执行器Failover。</li><li>执行模块（执行器）：负责接收调度请求并执行任务逻辑，任务模块专注于任务的执行等操作，开发和维护更简单和高效；接收“调度中心”的执行请求、终止请求和日志请求等。</li></ul><h2 id="6-xxl-job-admin核心代码"><a href="#6-xxl-job-admin核心代码" class="headerlink" title="6. xxl-job-admin核心代码"></a>6. xxl-job-admin核心代码</h2><h3 id="6-1-admin初始化工作"><a href="#6-1-admin初始化工作" class="headerlink" title="6.1 admin初始化工作"></a>6.1 admin初始化工作</h3><p>1）JobRegistryHelper#getInstance.start()保证任务执行的时候拿到的执行器列表都是运行的，启动一个守护线程。</p><pre><code>每30s查询数据库中自动注册的执行器；
查询90s未再次自动注册的执行器；
delete 删除90s未再次注册的执行器register表；
upate 更新group表的addressList；
</code></pre><p>2）JobRegistryHelper#getInstance.start()启动一个线程，扫描失败日志判断是否需要重试，需要重试则执行触发器；</p><p>3）initRpcProvider(); 初始化rpc服务，AdminBiz（任务执行结果回调、注册器执行器、移除执行器）</p><p>4）JobScheduleHelper#getInstance.start();</p><pre><code>scheduleThread 构建5s内要执行的任务；
ringThread 执行5s内任务的触发器；
</code></pre><h3 id="6-2-触发器的工作"><a href="#6-2-触发器的工作" class="headerlink" title="6.2 触发器的工作"></a>6.2 触发器的工作</h3><p>1）失败次数超过10次的任务使用慢线程池执行；<br>2）查询要执行任务的详细信息；<br>3）根据路由策略从执行器地址列表中得到通知的地址；</p><h2 id="7-面试题"><a href="#7-面试题" class="headerlink" title="7. 面试题"></a>7. 面试题</h2><p>你们的项目是分布式的吗？项目定时任务这一块是怎么做的？<br>分布式任务调度如果让你来实现，有什么思路，怎么实现？<br>有没有了解过一些开源的方案来解决这一块的问题？</p><p><strong>B站视频推荐：</strong><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1w541187Wa?p=1">https://www.bilibili.com/video/BV1w541187Wa</a></p><link rel="stylesheet" href="/crystal-blog/css/spoiler.css" type="text/css"><script src="/crystal-blog/js/spoiler.js" type="text/javascript" async></script></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/crystal-blog/about" rel="external nofollow noreferrer">王子</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://wang-qz.gitee.io/crystal-blog/crystal-blog/2021121231971.html">https://wang-qz.gitee.io/crystal-blog/crystal-blog/2021121231971.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/crystal-blog/about" target="_blank">王子</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/crystal-blog/tags/xxl-job/"><span class="chip bg-color">xxl-job</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/crystal-blog/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/crystal-blog/libs/share/js/social-share.min.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid="></script><div class="addthis_inline_share_toolbox"></div></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/crystal-blog/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/crystal-blog/medias/reward/wechatPay.jpg" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(https://cdn.jsdelivr.net/gh/drew233/cdn/20200409110727.webp) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}.v[data-class="v"] .vwrap .vheader .vinput{width:32%;border-bottom:1px dashed #dedede}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/crystal-blog/libs/valine/av-min.js"></script><script src="/crystal-blog/libs/valine2/Valine2.min.js"></script><script>let metaPlaceholder={nick:"昵称/QQ号(必填)",mail:"邮箱(必填)",link:"网址(https://)"};new Valine({el:"#vcomments",appId:"NiVMV7aR8ipVDy9EywBYtLwI-MdYXbMMI",appKey:"P7BGA1hMeBAFbHYz3dKY8doJ",notify:!1,verify:!0,visitor:!0,avatar:"monsterid",pageSize:"10",lang:"zh-CN",placeholder:"填写QQ号就能评论，快来一发吧~",meta:["nick","mail","link"],recordIP:!0,enableQQ:"monsterid",requiredFields:["nick","mail","link"],master:["e4de1f6da602d22e423d6dfb24611b6b"],friends:["410739a5ad278251b305dab085768c57","410739a5ad278251b305dab085768c57","410739a5ad278251b305dab085768c57"],tagMeta:["博主","小伙伴","访客"],metaPlaceholder:metaPlaceholder}),document.body.addEventListener("click",function(e){if(e.target.classList.contains("vsubmit")){var a=document.querySelector("input[type=email]"),t=document.querySelector("input[name=nick]");const i=/^[A-Za-z0-9_-\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;if(!a.value||!t.value||!i.test(a.value)){const n=document.querySelector(".vmark");n.innerHTML='<div class="valert txt-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>',n.style.display="block",e.stopPropagation(),setTimeout(function(){n.style.display="none",n.innerHTML=""},2500)}}},!0)</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/crystal-blog/2021123165337.html"><div class="card-image"><img src="https://cn.bing.com/th?id=OHR.OreamnosAmericanus_ZH-CN6731612431_1920x1080.jpg&rf=LaDigue_1920x1080.jpg" class="responsive-img" alt="微服务-Nacos注册中心兼配置中心"> <span class="card-title">微服务-Nacos注册中心兼配置中心</span></div></a><div class="card-content article-content"><div class="summary block-with-text">Nacos</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2021-12-31 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/crystal-blog/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="post-category">微服务</a></span></div></div><div class="card-action article-tags"><a href="/crystal-blog/tags/SpringCloudAlibaba/"><span class="chip bg-color">SpringCloudAlibaba</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/crystal-blog/2021121219170.html"><div class="card-image"><img src="https://cn.bing.com/th?id=OHR.FoxDovrefjell_ZH-CN9554491452_1920x1080.jpg&rf=LaDigue_1920x1080.jpg" class="responsive-img" alt="idea如何开启Run Dashboard"> <span class="card-title">idea如何开启Run Dashboard</span></div></a><div class="card-content article-content"><div class="summary block-with-text">idea开启Run Dashboard</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2021-12-12 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/crystal-blog/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/" class="post-category">工具篇</a></span></div></div><div class="card-action article-tags"><a href="/crystal-blog/tags/Intellij-IDEA/"><span class="chip bg-color">Intellij-IDEA</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){var n,t,o,r;void 0!==window.getSelection&&((""+(n=window.getSelection())).length<Number.parseInt("120")||(t=document.getElementsByTagName("body")[0],(o=document.createElement("div")).style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>"),r=document.location.href,o.innerHTML+='<br />来源: Crys&#39;s Blog<br />文章作者: crys<br />文章链接: <a href="'+r+'">'+r+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)))})</script><script type="text/javascript" src="/crystal-blog/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/crystal-blog/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/crystal-blog/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/crystal-blog/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/crystal-blog/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h2, h3, h4"});let t=0,e="toc-heading-";$("#toc-content a").each(function(){$(this).attr("href","#"+e+ ++t)}),t=0,$("#articleContent").children("h2, h3, h4").each(function(){$(this).attr("id",e+ ++t)});let n=parseInt(.4*$(window).height()-64),o=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>n?o.addClass("toc-fixed"):o.removeClass("toc-fixed")});const i="expanded";let c=$("#toc-aside"),l=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){c.hasClass(i)?(c.removeClass(i).hide(),l.removeClass("l9")):(c.addClass(i).show(),l.addClass("l9")),function(t,e){let n=$("#"+t);if(0!==n.length){let t=n.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+e).width(t)}}("artDetail","prenext-posts")})})</script></main><a onclick="switchNightMode()" id="sma"><i class="fa fa-moon-o" id="nightMode" aria-hidden="true"></i></a><footer class="page-footer bg-color"><link rel="stylesheet" href="/crystal-blog/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="tencent" type="playlist" id="7278393642" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="/crystal-blog/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2021-2022</span> <i class="fa fa-heart" style="color:#ff71a8"></i> <a href="/crystal-blog/about" target="_blank">crys</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><span style="margin-left:-20px;display:inline">&nbsp; <i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">182.7k</span> <span><span id="busuanzi_container_site_pv" style="display:inline">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv" style="display:inline">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2021",n=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),s=e.getSeconds(),e=Date.UTC(t,"8","8","8","8","8"),a=Date.UTC(n,a,r,i,o,s)-e,r=Math.floor(a/31536e6),i=Math.floor(a/864e5-365*r),o=Math.floor(a/36e5-365*r*24-24*i),s=Math.floor(a/6e4-365*r*24*60-24*i*60-60*o),e=Math.floor(a/1e3-365*r*24*60*60-24*i*60*60-60*o*60-60*s);t===String(n)?(document.getElementById("year").innerHTML=n,a="This site has been running for "+i+" days",a="本站已运行 "+i+" 天",document.getElementById("sitetime").innerHTML=a):(document.getElementById("year").innerHTML=t+" - "+n,n="This site has been running for "+r+" years and "+i+" days",n="本站已运行 "+r+" 年 "+i+" 天 "+o+" 小时 "+s+" 分钟 "+e+" 秒",document.getElementById("sitetime").innerHTML=n)},timer=setInterval(calcSiteTime)</script>&nbsp;|&nbsp; <span id="icp"><img src="/crystal-blog/medias/icp.png" style="vertical-align:text-bottom"> <a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备20002108号</a></span></span></div><div class="col s12 m4 l4 social-link social-statis"><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1848276756" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1848276756" data-position="top" data-delay="50"><i class="fab fa-qq"></i> </a><a href="mailto:wang-qz@foxmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我: wang-qz@foxmail.com" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="https://gitee.com/wang-qz" class="tooltipped" target="_blank" data-tooltip="码云" data-position="top" data-delay="50"><i class="fab fa-github-alt"></i> </a><a href="https://blog.csdn.net/u013044713" class="tooltipped" target="_blank" data-tooltip="关注我的CSDN" data-position="top" data-delay="50"><i class="fab fa-csdn">C</i> </a><a href="/crystal-blog/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><script>let _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?147475454185ebcf440a27cc35e793ef";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,r,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(r),n=document.getElementById(s);t.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s=!0,l=t.title.trim().toLowerCase(),a=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),c=0===(c=t.url).indexOf("/")?t.url:"/"+c,i=-1,u=-1;""!==l&&""!==a&&h.forEach(function(t,e){n=l.indexOf(t),i=a.indexOf(t),n<0&&i<0?s=!1:(i<0&&(i=0),0===e&&(u=i))}),s&&(o+="<li><a href='"+c+"' class='search-result-title'>"+l+"</a>",e=t.content.trim().replace(/<[^>]+>/g,""),0<=u&&(c=u+80,(c=0===(t=(t=u-20)<0?0:t)?100:c)>e.length&&(c=e.length),r=e.substr(t,c),h.forEach(function(t){var e=new RegExp(t,"gi");r=r.replace(e,'<em class="search-keyword">'+t+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}("/crystal-blog/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/crystal-blog/libs/materialize/materialize.min.js"></script><script src="/crystal-blog/libs/masonry/masonry.pkgd.min.js"></script><script src="/crystal-blog/libs/aos/aos.js"></script><script src="/crystal-blog/libs/scrollprogress/scrollProgress.min.js"></script><script src="/crystal-blog/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/crystal-blog/js/matery.js"></script><script src="/crystal-blog/js/funnyTitle.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="/crystal-blog/libs/others/clicklove.js" async></script><script async src="/crystal-blog/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" color="0,0,255" pointcolor="0,0,255" opacity="0.7" zindex="-1" count="99" src="/crystal-blog/libs/background/canvas-nest.js"></script><script type="text/javascript" src="/crystal-blog/libs/background/ribbon-dynamic.js" async></script><script src="/crystal-blog/libs/instantpage/instantpage.js" type="module"></script><script src="/crystal-blog/js/wenzi.js"></script><script src="/crystal-blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/crystal-blog/live2dw/assets/miku.model.json"},display:{position:"right",width:150,height:190,hOffset:50,vOffset:-5},mobile:{show:!1,scale:.5},react:{opacityDefault:.7,opacityOnHover:.8},log:!1})</script></body></html>